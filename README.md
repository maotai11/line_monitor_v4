# LINE Monitor v4

從 Windows 通知資料庫擷取 LINE 訊息，**靜默背景執行、零外部連線**，訊息只寫入指定的內網共用資料夾。

---

## 特色

- 背景靜默執行，不顯示任何視窗
- 從 Windows 通知資料庫讀取 LINE 訊息（不需要 LINE API）
- 訊息依聯絡人分資料夾、依日期分檔案
- 依對話間隔自動分段（預設 5 分鐘無新訊息即為新段落）
- 收到檔案自動複製到指定資料夾
- 支援設定白名單（只監控特定聯絡人）
- 封鎖所有外部網路，只允許內網連線（資安保護）
- 支援 Python Embeddable，不需安裝 Python

---

## 檔案說明

```
line_monitor_v4/
├── line_monitor.py        ← 主監控腳本（核心邏輯）
├── start_hidden.py        ← 啟動器，以完全隱藏方式執行主腳本
├── 啟動監控.vbs           ← 雙擊即可啟動（無視窗）
├── 啟動監控+顯示視窗.vbs  ← 啟動並顯示視窗（除錯用）
└── 設定控制台.html        ← 用瀏覽器開啟，設定共用資料夾、監控對象等
```

---

## 使用流程

### 1. 設定

用瀏覽器開啟 `設定控制台.html`，填寫以下項目後儲存：

| 設定項目 | 說明 |
|---|---|
| 共用資料夾路徑 | 訊息要寫入的資料夾（如 `\\server\line-logs` 或本機路徑） |
| 監控名單 | 留空 = 監控所有人；填入聯絡人名稱可只監控特定對象 |
| 掃描間隔 | 多少秒讀取一次通知（預設 60 秒） |
| 對話分段間隔 | 幾分鐘無新訊息視為新段落（預設 5 分鐘） |
| 自動複製收到的檔案 | 開啟後會自動把收到的檔案備份到指定資料夾 |

儲存後會在同目錄產生 `config.json`。

### 2. 啟動監控

雙擊 **`啟動監控.vbs`**，背景靜默執行，不會出現任何視窗。

> 若要確認是否正在運行，可開啟工作管理員查看 `pythonw.exe` 程序。

### 3. 查看紀錄

- 訊息儲存在 `共用資料夾/聯絡人名稱/聯絡人名稱_YYYY-MM-DD.txt`
- 收到的檔案儲存在 `共用資料夾/聯絡人名稱/收到的檔案/`
- 執行 log 在腳本同目錄的 `run.log`

---

## 輸出格式範例

```
═══ 王小明  2025-01-01 ═══════════════════════

[09:00:01] 早安！
[09:00:45] 今天幾點開會？

── 2025-01-01 14:32:10 新段落 ──────────────────────

[14:32:10] 下午會議改到三點
```

---

## Python Embeddable 安裝說明

Python Embeddable 就是一個資料夾，**不需要安裝到電腦**，直接解壓縮放進去就能用。

### 下載步驟

1. 前往 https://www.python.org/downloads/windows/
2. 找最新版本，點進去
3. 找 **"Windows embeddable package (64-bit)"** 下載（約 10MB 的 zip）
4. 解壓縮後，把整個資料夾內容放到 USB 裡的 `python\` 資料夾

### 目錄結構

```
USB隨身碟/
└── python/
    ├── python.exe      ← 解壓縮後長這樣
    ├── pythonw.exe
    ├── python312.zip
    └── ...
```

放好後，`.vbs` 啟動腳本會自動使用同目錄的 `python\pythonw.exe` 執行，不依賴系統安裝的 Python。

---

## 注意事項

- 需要 LINE Windows 版本保持登入狀態，通知資料庫才會有資料
- 若訊息未顯示在 Windows 通知中心，本工具也無法擷取
- 本工具**不會**上傳任何資料到外部網路，所有資料只留在本機或內網
